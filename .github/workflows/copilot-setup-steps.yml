name: "Copilot Setup Steps"

# Automatically run the setup steps when they are changed to allow for easy validation, and
# allow manual testing through the repository's "Actions" tab
on:
    workflow_dispatch:
    push:
        paths:
            - .github/workflows/copilot-setup-steps.yml
    pull_request:
        paths:
            - .github/workflows/copilot-setup-steps.yml

#Environment variables set in workflow do not seem to work when run by Copilot.

jobs:
    # The job MUST be called `copilot-setup-steps` or it will not be picked up by Copilot.
    copilot-setup-steps:
        runs-on: ubuntu-latest

        # Copilot will be given its own token for its operations.
        permissions:
            contents: read

        steps:
            - name: Checkout code
              uses: actions/checkout@v5
              with:
                  ref: develop
                  fetch-depth: 0

            - name: Set up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "20"
                  cache: "npm"
                  cache-dependency-path: CarWash.PWA/ClientApp/package-lock.json

            - name: Install PWA npm dependencies
              run: npm ci
              working-directory: CarWash.PWA/ClientApp

            - name: Setup .NET SDK
              uses: actions/setup-dotnet@v3
              with:
                  dotnet-version: 8.0.x

            - name: .NET Tool Restore
              run: dotnet tool restore

            - name: Restore PWA
              run: dotnet restore "CarWash.PWA"

            - name: Restore Functions
              run: dotnet restore "CarWash.Functions"
